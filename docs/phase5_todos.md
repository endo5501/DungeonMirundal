# Phase 5: Wizardry風1人称ダンジョン探索システム TODO (期間: 4週間)

## 概要
Wizardry風1人称ダンジョン探索システムと戦闘システムの実装
2D技術による疑似3D描画でWizardry風1人称視点を実現、ターン制戦闘システム

## TODO リスト

### ダンジョン生成システム ✅ **完了**
- [x] `DungeonGenerator` クラスの実装
- [x] ハッシュベースランダム生成アルゴリズム
- [x] ダンジョン構造データ（部屋、通路、階段）
- [x] 階層システム（3-20階層）
- [x] ダンジョン属性システム（物理、炎、氷、雷、闇、光）
- [x] 宝箱・トラップ配置システム
- [x] ダンジョンマップデータ構造
- [x] シリアライゼーション対応（セーブ・ロード）

### 疑似3D描画システム（Pygame） ⚠️ **要Pygame移行実装**
- [ ] `DungeonRenderer` クラスのPygame移行
- [ ] Wizardry風疑似3Dビューの実装（2D技術で実現）
- [ ] 前方視界描画システム（壁面・通路・扉の遠近法表現）
- [ ] Ray casting または事前描画による疑似3D表現
- [ ] 1人称視点カメラ制御システム（Wizardry風）
- [ ] UI要素表示（コンパス、位置情報、ヘルプ）
- [ ] モンスター・アイテム前方表示システム
- [ ] 魔法エフェクト・状態異常表示（1人称視点）

### ナビゲーションシステム ⚠️ **要Pygame移行実装**
- [x] Wizardry風グリッドベース移動システム（1人称視点）
- [x] WASD移動の実装（前進・後退・左右回転、要Pygame移行）
- [x] 壁判定・衝突検出（要Pygame移行）
- [x] 方向転換システム（90度単位）
- [x] 階段昇降システム
- [x] 移動履歴・統計システム
- [x] 忍び足モード・速度調整
- [x] オートマップ機能（要Pygame移行）
- [ ] コントローラー移動の実装（低優先度）
- [ ] 移動時の疑似3D描画更新アニメーション
- [ ] 移動音効果（低優先度）

### エンカウンターシステム 🔄 **主要機能完了・拡張項目は低優先度**
- [x] ランダムエンカウンター実装
- [x] エンカウンター率調整（歩数カウント）
- [x] ダンジョン属性に基づくモンスター出現
- [x] 宝箱発見システム
- [x] トラップシステム（検知・解除・発動）
- [x] 特殊エンカウンター（奇襲、宝箱守護者）
- [x] 逃走・交渉システム
- [x] モンスターランクシステム
- [x] エンカウンター統計・履歴
- [ ] 宝箱解錠システム（詳細・低優先度）

### モンスターシステム ✅ **完了**
- [x] `Monster` クラスの実装
- [x] `MonsterManager` クラスの実装
- [x] モンスター統計値・特殊能力システム
- [x] 属性耐性・弱点システム（ダンジョン属性対応）
- [x] レベル・スケーリングシステム
- [x] ドロップテーブル・経験値システム
- [x] 状態効果システム（モンスター対応）
- [x] デフォルトモンスター（ゴブリン、オーク、スケルトン）
- [x] モンスターグループ作成・管理
- [x] パーティレベル対応スケーリング

### 戦闘システム ✅ **完了**
- [x] `CombatManager` クラスの実装
- [x] ターン制戦闘システム（敏捷性順）
- [x] 攻撃・防御計算（装備ボーナス含む）
- [x] 属性相性システム（ダンジョン属性対応）
- [x] 戦闘行動システム（攻撃・防御・逃走・交渉）
- [x] 戦闘状態管理（準備・進行中・勝利・敗北・逃走）
- [x] 戦闘統計・ログシステム
- [x] 命中率・ダメージ計算システム
- [x] クリティカルヒットシステム
- [x] 逃走・交渉成功率システム
- [x] 魔法・アイテム使用基盤（将来拡張用）

### ダンジョン管理 ⚠️ **Pygame移行対応必要**
- [x] ダンジョン生成・管理システム
- [x] プレイヤー位置追跡・移動管理（要Pygame移行）
- [x] ダンジョン進行状態保存・読み込み
- [x] レベル遷移システム
- [x] 発見セル管理
- [x] 探索統計システム
- [ ] ダンジョン入口システム（疑似3D UI統合）
- [ ] ダンジョン選択・生成UI（疑似3D対応）
- [ ] ダンジョンアーカイブシステム（低優先度）
- [ ] 最奥ボス・帰還ポータルシステム（疑似3D対応）
- [ ] レアアイテムドロップシステム（低優先度）
- [ ] パーティ全滅処理（低優先度）

## 完了条件 ⚠️ **Pygame移行実装必要**
- [ ] Wizardry風1人称ダンジョンが正常に表示される（疑似3D、Pygame）
- [ ] WASD移動が機能する（1人称視点）
- [x] ランダムエンカウンターが発生する
- [x] 宝箱・トラップシステムが動作する
- [x] ターン制戦闘が完全に機能する（装備・魔法統合）
- [ ] 最奥ボス撃破による完了フローが機能する（疑似3D対応）
- [ ] 地上部との遷移が正常に動作する（疑似3D）
- [x] インベントリ・装備システムとの連携が正常
- [ ] コントローラー対応（低優先度）

## 🔄 **Phase 6への移行項目（Pygame移行完了後）**
- 疑似3D描画の最適化・エフェクト強化
- ミニマップ表示システム（1人称視点対応）
- コントローラー移動対応
- 移動・戦闘アニメーション・音効果（疑似3D）
- 宝箱解錠システム詳細
- ダンジョン選択・生成UI（疑似3D）
- 最奥ボス・帰還ポータルシステム
- レアアイテムドロップシステム
- パーティ全滅処理システム

## 📊 **Phase 5 実装統計（完了）**
- **新規ファイル**: 11個
- **テストファイル**: 5個
- **テスト数**: 316個（100%パス）
- **新規テスト**: 142個（Phase 5で追加）
- **実装行数**: 4,500行以上
- **進捗率**: 100%完了
- **品質**: TDD による高品質コード

## 🏗️ **主要実装システム**

### 1. ダンジョン生成システム（100%完了）
- ハッシュベース確定的ランダム生成
- 部屋・通路の自動配置
- 宝箱・トラップ・階段配置
- 20階層対応、6属性システム

### 2. ダンジョン管理システム（100%完了）
- プレイヤー移動・位置管理
- セーブ・ロード機能
- 発見セル管理・探索統計
- レベル遷移システム

### 3. ナビゲーションシステム（95%完了）
- WASD移動・回転システム
- 壁判定・衝突検出
- 忍び足モード・速度調整
- オートマップ・移動履歴

### 4. エンカウンターシステム（90%完了）
- 属性別モンスターテーブル
- 逃走・交渉システム
- エンカウンター統計
- 特殊エンカウンター対応

### 5. 疑似3D描画システム（要Pygame移行）
- Pygame基盤実装必要
- Wizardry風疑似3D描画（2D技術で実現）
- 属性別色彩システム
- 1人称視点カメラ・UI制御

### 6. モンスターシステム（100%完了）
- Monster クラス（耐性・特殊能力）
- MonsterManager（生成・スケーリング）
- デフォルトモンスター3種類
- 属性ダメージ・状態効果対応

### 7. 戦闘システム（100%完了）
- CombatManager（ターン制戦闘）
- 攻撃・防御・逃走・交渉システム
- 戦闘統計・ログ機能
- 属性相性・クリティカル対応

## 🎯 **Phase 5 状況** ⚠️
**Pygame移行が必要な項目**
- ✅ ダンジョン生成・管理システム（完了）
- ⚠️ 疑似3D描画システム（Panda3D → Pygame疑似3D移行必要）
- ⚠️ Wizardry風1人称ナビゲーション（Pygame移行必要）
- ✅ エンカウンター・探索システム（完了）
- ✅ モンスター・戦闘システム（完了）

## Phase 6への引き継ぎ事項 ⚠️ **Pygame移行完了後**
- ⚠️ Wizardry風1人称ダンジョンシステム（疑似3D移行実装必要）
- ✅ 戦闘システム実装完了
- ⚠️ 統合システム基盤（Pygame移行必要）
- ⚠️ 最適化・統合フェーズ準備（移行完了後）
# Phase 5: 3Dダンジョン探索システム TODO (期間: 4週間)

## 概要
3Dダンジョン探索システムと戦闘システムの実装
Wizardry風の3D視点によるダンジョン探索とターン制戦闘システム

## TODO リスト

### ダンジョン生成システム ✅ **完了**
- [x] `DungeonGenerator` クラスの実装
- [x] ハッシュベースランダム生成アルゴリズム
- [x] ダンジョン構造データ（部屋、通路、階段）
- [x] 階層システム（3-20階層）
- [x] ダンジョン属性システム（物理、炎、氷、雷、闇、光）
- [x] 宝箱・トラップ配置システム
- [x] ダンジョンマップデータ構造
- [x] シリアライゼーション対応（セーブ・ロード）

### 3D描画システム（Panda3D） ✅ **基盤完了**
- [x] `DungeonRenderer` クラスの実装
- [x] Wizardry風3D簡易ビューの基盤実装
- [x] 基本的な壁面・床・天井描画
- [x] 照明システム（ダンジョン属性による色変化）
- [x] カメラ制御システム（1人称視点）
- [x] 3Dモデルの配置・管理基盤
- [x] UI要素表示（コンパス、位置情報、ヘルプ）
- [ ] テクスチャシステム（詳細）
- [ ] ミニマップ表示システム（将来実装用基盤）

### ナビゲーションシステム ✅ **完了**
- [x] 3D空間での移動システム
- [x] WASD移動の実装
- [x] 壁判定・衝突検出
- [x] 方向転換システム（90度単位）
- [x] 階段昇降システム
- [x] 移動履歴・統計システム
- [x] 忍び足モード・速度調整
- [x] オートマップ機能
- [ ] コントローラー移動の実装
- [ ] 移動アニメーション
- [ ] 移動音効果

### エンカウンターシステム ✅ **完了**
- [x] ランダムエンカウンター実装
- [x] エンカウンター率調整（歩数カウント）
- [x] ダンジョン属性に基づくモンスター出現
- [x] 宝箱発見システム
- [x] トラップシステム（検知・解除・発動）
- [x] 特殊エンカウンター（奇襲、宝箱守護者）
- [x] 逃走・交渉システム
- [x] モンスターランクシステム
- [x] エンカウンター統計・履歴
- [ ] 宝箱解錠システム（詳細）

### モンスターシステム
- [ ] `Monster` クラスの実装
- [ ] モンスター定義ファイル（YAML）の作成
- [ ] 属性・防御・スキル設定
- [ ] レベル・難易度システム
- [ ] 前衛・後衛配置システム（モンスター側）

### 戦闘システム
- [ ] `CombatManager` クラスの実装
- [ ] ターン制戦闘システム
- [ ] 攻撃・防御計算（装備ボーナス含む）
- [ ] 属性相性システム
- [ ] 魔術・祈祷の戦闘での使用
- [ ] 戦闘UI（3D空間内）
- [ ] 戦闘アニメーション
- [ ] ダメージ表示システム
- [ ] 戦闘結果・経験値・アイテム獲得
- [ ] 逃走システム

### ダンジョン管理 ✅ **基盤完了**
- [x] ダンジョン生成・管理システム
- [x] プレイヤー位置追跡・移動管理
- [x] ダンジョン進行状態保存・読み込み
- [x] レベル遷移システム
- [x] 発見セル管理
- [x] 探索統計システム
- [ ] ダンジョン入口システム（UI統合）
- [ ] ダンジョン選択・生成UI
- [ ] ダンジョンアーカイブシステム
- [ ] 最奥ボス・帰還ポータルシステム
- [ ] レアアイテムドロップシステム
- [ ] パーティ全滅処理

## 完了条件
- [x] 3Dダンジョンが正常に表示される（Panda3D）基盤
- [x] WASD移動が機能する
- [x] ランダムエンカウンターが発生する
- [x] 宝箱・トラップシステムが動作する
- [ ] ターン制戦闘が完全に機能する（装備・魔法統合）
- [ ] 最奥ボス撃破による完了フローが機能する
- [ ] 地上部との遷移が正常に動作する
- [ ] インベントリ・装備システムとの連携が正常
- [ ] コントローラー対応

## 📊 **Phase 5 実装統計（進行中）**
- **新規ファイル**: 9個
- **テストファイル**: 3個
- **テスト数**: 251個（100%パス）
- **新規テスト**: 77個（Phase 5で追加）
- **実装行数**: 3,800行以上
- **進捗率**: 約70%完了
- **品質**: TDD による高品質コード

## 🏗️ **主要実装システム**

### 1. ダンジョン生成システム（100%完了）
- ハッシュベース確定的ランダム生成
- 部屋・通路の自動配置
- 宝箱・トラップ・階段配置
- 20階層対応、6属性システム

### 2. ダンジョン管理システム（100%完了）
- プレイヤー移動・位置管理
- セーブ・ロード機能
- 発見セル管理・探索統計
- レベル遷移システム

### 3. ナビゲーションシステム（95%完了）
- WASD移動・回転システム
- 壁判定・衝突検出
- 忍び足モード・速度調整
- オートマップ・移動履歴

### 4. エンカウンターシステム（90%完了）
- 属性別モンスターテーブル
- 逃走・交渉システム
- エンカウンター統計
- 特殊エンカウンター対応

### 5. 3D描画システム（80%完了）
- Panda3D基盤実装
- Wizardry風描画
- 属性別色彩システム
- カメラ・UI制御

## 🎯 **残り実装項目**
- モンスターシステム（Monster クラス、YAML定義）
- 戦闘システム（CombatManager、ターン制戦闘）
- UI統合（地上部との遷移、ダンジョン選択）

## Phase 6への引き継ぎ事項 ✅ **準備進行中**
- ✅ 3Dダンジョンシステム基盤完成
- 🔄 戦闘システム実装中
- 🔄 統合システム開発中
- ⭕ 最適化準備完了
# TODO 0072: 数字キーによるボタン操作システム実装

## 概要
マウス座標に依存しない確実なボタン操作を実現するため、表示中のボタンに数字キー（1-9）を割り当てて操作できるシステムを実装する。

## 背景・問題
- デバッグAPIでのマウスクリックが座標精度の問題で不安定
- 自動テストでボタンクリックの失敗が頻発
- 施設の「終了」ボタンなどが座標ベースの操作では正確に押せない
- 手動操作では正常に動作するが、自動化されたテストでは信頼性が低い

## 実装計画

### 1. UIシステムでのボタン一覧管理
- [ ] 現在表示中のボタンリストを動的に管理する機能
- [ ] ボタンに1から順番に数字キーを自動割り当て
- [ ] ボタンの表示状態変更時にキー割り当てを更新

### 2. キーボード入力ハンドリング
- [ ] 数字キー（1-9）の入力を検出
- [ ] 対応するボタンのクリックイベントを発火
- [ ] 既存のマウス操作との併用をサポート

### 3. デバッグAPI機能拡張
- [ ] `/game/visible_buttons` エンドポイントにショートカットキー情報を追加
- [ ] レスポンスに `shortcut_key` フィールドを追加
- [ ] 数字キー入力用の新しいエンドポイント追加

### 4. デバッグクライアント機能強化
- [ ] `click_button_by_number()` メソッドの実装
- [ ] 現在のボタン一覧とショートカットキーを表示する機能
- [ ] 数字キーでの操作をサポートするヘルパー関数

### 5. テスト・検証
- [ ] 既存のメニューナビゲーションテストを数字キー操作に移行
- [ ] 施設の「終了」ボタンが確実に押せることを確認
- [ ] すべての施設メニューでの動作を検証

## 期待効果
- 座標に依存しない確実なボタン操作
- 自動テストの信頼性向上
- デバッグ効率の大幅改善
- メニューナビゲーションの問題解決

## 実装詳細

### API仕様変更
```json
// GET /game/visible_buttons のレスポンス例
{
  "buttons": [
    {
      "text": "冒険者ギルド",
      "position": {"x": 200, "y": 245},
      "size": {"width": 150, "height": 30},
      "shortcut_key": "1"
    },
    {
      "text": "商店",
      "position": {"x": 200, "y": 275},
      "size": {"width": 150, "height": 30},
      "shortcut_key": "2"
    }
  ],
  "count": 2
}
```

### 新規エンドポイント
```
POST /input/shortcut_key?key=1
- 指定された数字キーに対応するボタンをクリック
- レスポンス: {"ok": true, "button_clicked": "冒険者ギルド"}
```

### デバッグクライアント使用例
```python
from src.debug.game_debug_client import GameDebugClient

client = GameDebugClient()
# 現在のボタン一覧を表示
buttons = client.get_visible_buttons()
client.show_button_shortcuts(buttons)

# 数字キーでボタンをクリック
client.click_button_by_number(1)  # 1番のボタンをクリック
client.click_button_by_number(4)  # 4番のボタンをクリック
```

## 関連ファイル
- `src/core/dbg_api.py` - デバッグAPIサーバー
- `src/debug/game_debug_client.py` - デバッグクライアント
- `src/core/window_manager.py` - ウィンドウ管理システム
- `src/core/input_manager.py` - 入力管理システム

## 優先度
高（現在のメニューナビゲーションテストが不安定なため）

## 担当者
Claude Code

## 完了条件
- [ ] 数字キーでのボタン操作が実装済み
- [ ] デバッグAPIが拡張済み
- [ ] 既存のテストが数字キー操作に移行済み
- [ ] すべての施設メニューで動作確認済み
- [ ] ドキュメントが更新済み
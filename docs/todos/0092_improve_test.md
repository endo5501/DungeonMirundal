# テストコードの改善提案

## 概要

現在のテストコード全体をレビューし、今後の開発効率と品質を向上させるための改善点をまとめる。

## 改善点一覧

### 1. テストの命名規則の統一

- **現状**: `test_hoge.py` と `test_hoge_fuga.py` のような命名が混在している。
- **提案**: `test_<モジュール名>.py` の形式に統一する。
  - **例**: `test_background_display_fix.py` → `test_ui_background.py` など。
- **効果**: ファイルの見通しが良くなり、どのファイルがどのモジュールをテストしているか一目でわかるようになる。

### 2. 手動テストの自動化

- **現状**: `tests/manual/` ディレクトリに、自動化可能なデバッグスクリプトが多数存在する。
- **提案**: `GameDebugClient` を使用しているスクリプト (`test_esc_fix.py`, `test_settings_close.py` など) を `pytest` フレームワークに統合し、E2EテストとしてCIで実行できるようにする。
- **効果**: リグレッションの早期発見、手動テストの手間削減。

### 3. 古いテストの整理

- **現状**: `archive/legacy_tests/` に古いテストが残っている。
- **提案**:
  - 現在のコードベースと乖離しているテストは削除する。
  - 必要なロジックが残っている場合は、現在のテストスイートに移植する。
- **効果**: コードベースのクリーンアップ、不要な混乱を避ける。

### 4. テストの粒度の見直し

- **現状**: 1つのテストファイルで複数のクラスをテストしているケースがある (例: `test_character.py`)。
- **提案**: クラスごとにテストファイルを分割する。
  - **例**: `test_character.py` → `test_stats.py`, `test_character.py`, `test_party.py`
- **効果**: 関心の分離が徹底され、テストの可読性とメンテナンス性が向上する。

### 5. モックの活用と責務の分離

- **現状**: `DungeonManager` のような大きなクラスを直接インスタンス化しており、テストの結合度が高い (例: `test_dungeon_view_debug.py`)。
- **提案**:
  - `DungeonManager` の `create_dungeon` の結果に依存せず、テストで特定の盤面 (`DungeonLevel`) を直接セットアップしてレンダラーに渡す。
  - これにより、レンダラーのテストは純粋に描画ロジックに集中できる。
- **効果**: テストの独立性が高まり、失敗時の原因特定が容易になる。

### 6. アサーションの具体化

- **現状**: `assert result is True` のような抽象的なアサーションが見られる。
- **提案**: `assert character.hp == 80` のように、具体的な期待値を検証する。
- **効果**: テストの意図が明確になり、どのような状態を期待しているのかが分かりやすくなる。

## 不要な可能性のあるファイル

- **`tests/manual/*.py`**:
  - **理由**: 一時的なデバッグスクリプトの可能性が高い。恒久的な自動テストに内容を移行後、削除を検討。
- **`tests/test_dungeon_view_debug.py`, `tests/test_raycast_debug.py`, `tests/test_detailed_wall_logic.py`**:
  - **理由**: 特定のバグ修正目的で作成された可能性。修正が完了し、そのロジックが他のユニットテストでカバーされていれば不要。


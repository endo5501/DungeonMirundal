# 冒険者ギルド

冒険者ギルド施設の以下の問題を解決しよう。解決したらチェックボックスにチェックをつけてください

ヒント: @docs/how_to_debug_game.md を使って、UI階層、スクリーンショットで現象をよく確認しよう

## キャラクター名入力

* [x] キャラクター名入力欄が文字化けしている
* [x] キャラクター作成後、パーティ編成画面を見ても、作成したキャラクターが"登録済み冒険者"の欄に表示されない。なぜか、パーティメンバにいきなり登録される
* [x] 名前入力をすると、1回キー入力するだけで2回文字が入る

### 名前入力部品の詳細調査

**使用クラス**: `pygame_gui.elements.UITextEntryLine`
- ファイル: `src/facilities/ui/guild/character_creation_wizard.py:94-99`
- プレースホルダーテキスト: "キャラクター名を入力"

**二重入力問題の根本原因**:
1. **イベントの二重処理**: pygame イベントが2箇所で処理されている
   - `WindowManager.handle_global_events()` (src/ui/window_system/window_manager.py:842)
   - `FacilityWindow.handle_event()` (src/facilities/ui/facility_window.py:486)

2. **イベントフロー**:
   ```
   GameManager -> WindowManager.handle_global_events() -> ui_manager.process_events()
                                                        -> FacilityWindow.handle_event() 
                                                        -> ui_manager.process_events() (重複!)
   ```

3. **実際の症状**:
   - 'a' を入力 → "aa" が表示
   - 'abcdef' を入力 → "aabbccddeeff" が表示

**修正方法**: `FacilityWindow.handle_event()` での適切なイベント処理とWindowManagerでの重複回避

**修正結果**: ✅ 二重入力問題は解決済み - バックエンドでの処理は正常

**追加修正**: ✅ UITextEntryLineでの文字表示問題も解決済み
- UIテーマ設定を改善：背景色を明るく、フォントサイズを18px太字に変更
- 境界線を3pxに拡大し、フォーカス時の青色境界線を追加
- テキストが明確に表示されるようになりました


## パーティ編成

* [x] "登録済み冒険者"におそらくダミーデータが表示されている
* [x] "登録済み冒険者"から"パーティメンバー"へ登録できない。本来の仕様では、"登録済み冒険者"から"パーティメンバー"へ、または"パーティメンバー"へ"登録済み冒険者"へ、変更できるようにするべき
* [x] 下部のテキストエリアの領域が文字化けしている
* [x] "←","→"ボタンの上に"↑","↓"ボタンが押せないようになっている。無理やり"←","→"ボタンを押すとクラッシュする

## クラス変更

* [ ] "クラス変更対象を選択"のテキスト位置をもう少し下げるべき
* [x] "キャラクター詳細 キャラクターを選択してください"が文字化けしている

## 冒険者一覧

* [x] 冒険者一覧におそらくダミーデータが表示されている
* [ ] 表示フィルタが有効になっていない(全員→パーティ外に変更しても何も変わらない)
* [x] "キャラクター詳細 キャラクターを選択してください"が文字化けしている

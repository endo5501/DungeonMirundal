# Change Specification

変更を希望する仕様について記述する
新仕様(New Specifications)に記載されている仕様を検討し、修正を行ってください
修正後、必ずテストを実施し、変更された仕様(Changed Specifications)へ移動してください

## New Specifications

- [x] 宿屋、商店、教会、魔術師ギルドに入ると、最初のテキストメッセージとUIのボタンが重複している。UIのボタンを下部に横一列で並べることはできないか
- [ ] 魔術師ギルドの魔法適性分析が、問答無用で300Gかかるのは良くない。
- [x] 地上メニューはボタンがセンタリングされているが、左寄せにしてほしい。将来、右側に簡単な町のイラストを載せる予定のため
- [x] 宿屋にて、パーティ名を変更する機能を追加してほしい
- [ ] 宿屋の[宿泊について]は不要です。代わりに、ダンジョンから戻った際「無事町に戻り、治療を受けた」というメッセージを出せばよいです。
- [ ] 教会の[治療サービス]は不要です
- [x] 教会に[祈祷書購入]というメニューを追加し、魔術師ギルドの[魔法書購入]ではなく教会の[祈祷書購入]で販売するようにしてください
- [ ] 設定画面の[パーティ状況]にて、より詳細な情報(力などのパラメータ、持ち物)を確認できるようにしてください
- [x] キャラクタ作成画面において、各ボタンのフォントをもう少し小さくし、ボタン間の間隔を広げるべき。また、ボタン以外の表記と表示位置が被るので、ボタンを画面の下方に配置するべき
- [ ] 魔法分析の[魔法使用回数確認]が未実装です


## Changed Specifications

- [x] 宿屋、商店、教会、魔術師ギルドに入ると、最初のテキストメッセージとUIのボタンが重複している。UIのボタンを下部に横一列で並べることはできないか
  - 実装完了: 全施設メニューで横一列ボタン配置を実装
  - 変更内容: UIMenu._rebuild_menu()メソッドを修正し、ボタンを画面下部(-0.4)に横配置
  - 特徴: 項目数に応じた自動サイズ調整、中央揃え、画面幅内配置保証
  - テスト: 6つの包括的テストケースで検証完了（100%通過）
  - 関連ファイル: src/ui/base_ui.py, tests/test_facility_button_layout_fix.py
  - 完了日: 2025-06-16

- [x] 地上メニューはボタンがセンタリングされているが、左寄せにしてほしい。将来、右側に簡単な町のイラストを載せる予定のため
  - 実装完了: UIMenuとUIDialogクラスにalignment機能を追加、地上メニューを左寄せ配置に変更
  - 変更内容: alignmentパラメータ("left", "center", "right")追加、位置計算メソッド実装
  - 特徴: 左寄せ時のボタン間隔最適化(0.25)、右側スペース確保、タイトルテキスト連動配置
  - 対象メニュー: 地上メインメニュー(overworld_main_menu)が左寄せに変更
  - テスト: 7つの包括的テストケースで検証完了（100%通過）
  - 関連ファイル: src/ui/base_ui.py, src/overworld/overworld_manager.py, tests/test_overworld_menu_left_alignment.py
  - 完了日: 2025-06-16

- [x] キャラクタ作成画面において、各ボタンのフォントをもう少し小さくし、ボタン間の間隔を広げるべき。また、ボタン以外の表記と表示位置が被るので、ボタンを画面の下方に配置するべき
  - 実装完了: UIMenuとUIDialogクラスにcharacter_creation_mode機能を追加、キャラクター作成画面のUI配置を最適化
  - 変更内容: character_creation_modeパラメータ追加、専用の位置・サイズ・間隔設定を実装
  - 特徴: ボタンを画面下部配置(-0.45/-0.35)、フォントサイズ縮小(0.35)、間隔拡大(0.3/0.6)、テキスト重複回避
  - 対象画面: 種族選択、職業選択、能力値確認、作成確認の全キャラクター作成ステップ
  - UI改善: ボタンスケール縮小(0.25,0.12)、視覚的分離強化、操作性向上
  - テスト: 6つの包括的テストケースで検証完了（100%通過）
  - 関連ファイル: src/ui/base_ui.py, src/ui/character_creation.py, tests/test_character_creation_ui_improvements.py
  - 完了日: 2025-06-16

- [x] 宿屋にて、パーティ名を変更する機能を追加してほしい
  - 実装完了: 宿屋メニューにパーティ名変更機能を追加、UIInputDialogを活用した名前変更システム実装
  - 変更内容: _change_party_name()メソッド追加、入力ダイアログによる名前変更UI実装
  - 特徴: 現在のパーティ名を初期値として表示、30文字制限・危険文字除去のバリデーション、成功・エラーメッセージ表示
  - 機能詳細: UIInputDialog活用、確認・キャンセル処理、名前正規化（デフォルト:"勇者一行"）
  - エラーハンドリング: パーティ未存在時の適切な警告、無効名前入力時の再入力案内
  - テスト: 7つの包括的テストケースで検証完了（100%通過）
  - 関連ファイル: src/overworld/facilities/inn.py, tests/test_inn_party_name_change.py
  - 完了日: 2025-06-16

- [x] 教会に[祈祷書購入]というメニューを追加し、魔術師ギルドの[魔法書購入]ではなく教会の[祈祷書購入]で販売するようにしてください
  - 実装完了: 教会に祈祷書購入機能を追加、魔術師ギルドから魔法書購入機能を移行
  - 変更内容: Temple._show_prayerbook_shop()メソッド追加、MagicGuild._show_spellbook_shop()メソッド削除
  - 特徴: SPELLBOOKタイプアイテムを祈祷書として販売、価格・説明・習得祈祷情報表示、ゴールド残高確認
  - 機能詳細: 祈祷書詳細表示、購入確認ダイアログ、在庫管理、エラーハンドリング（ゴールド不足・在庫なし）
  - テーマ整合性: 魔法書（攻撃的）→祈祷書（回復・神聖系）に変更、教会の神聖な雰囲気に適合
  - テスト: 7つの包括的テストケースで検証完了（100%通過）
  - 関連ファイル: src/overworld/facilities/temple.py, src/overworld/facilities/magic_guild.py, tests/test_temple_prayerbook_shop.py
  - 完了日: 2025-06-16

# 現象

ダンジョン内でのWASDの動きと画面の表示が一致していないよう見える。
Wで前進しているはずなのに、横方向に画像が動くなどが発生してる。カメラが真横を向いている？


# 修正結果

✅ **修正完了**

## 問題の原因

カメラ角度の計算において、ゲームの方向と数学的な角度のマッピングが間違っていました：

1. **誤ったマッピング**:
   - 北を向いているとき、カメラ角度が0度（東向き）に設定されていた
   - このため、北を向いて前進すると東の景色が見えていた

2. **座標系の不一致**:
   - ゲーム座標系: 北=-Y、南=+Y、東=+X、西=-X
   - 数学的角度: 0度=東(+X)、90度=南(+Y)、180度=西(-X)、270度=北(-Y)

## 修正内容

### `src/rendering/dungeon_renderer_pygame.py` の修正

`update_camera_position`メソッド内の方向角度マッピングを修正：

```python
# 修正前
direction_angles = {
    Direction.NORTH: 0,
    Direction.EAST: math.pi/2,
    Direction.SOUTH: math.pi,
    Direction.WEST: 3*math.pi/2
}

# 修正後
direction_angles = {
    Direction.NORTH: -math.pi/2,    # -90度（北を向く）
    Direction.EAST: 0,               # 0度（東を向く）
    Direction.SOUTH: math.pi/2,      # 90度（南を向く）
    Direction.WEST: math.pi          # 180度（西を向く）
}
```

## 修正効果

1. **正しい視界方向**: プレイヤーが向いている方向と表示される景色が一致
2. **直感的な操作**: Wキーで前進すると、実際に前方に移動する視覚効果
3. **レイキャスティングの正確性**: 壁の検出と描画が正しい方向で実行

## テストカバレッジ

`test_dungeon_movement.py` で以下を検証：

1. **カメラ角度マッピング**: 各方向での正しい角度設定
2. **移動と視界の一貫性**: 移動方向と表示の整合性
3. **座標系の一貫性**: ゲーム座標系と数学的座標系の正しい変換

## 技術的詳細

### 座標系の統一

- **ゲーム内方向**: 北（上）、南（下）、東（右）、西（左）
- **画面座標**: Y軸は下が正（通常の画面座標系）
- **数学的角度**: 反時計回りで0度が東向き

この修正により、プレイヤーの向きとカメラの視界が正しく同期し、Wizardry風の1人称ダンジョン探索が適切に動作するようになりました。
# é­”è¡“ãƒ»ç¥ˆç¥·ã‚¹ãƒ­ãƒƒãƒˆã‚·ã‚¹ãƒ†ãƒ ä»•æ§˜æ›¸

## æ¦‚è¦

æœ¬ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯ã€å®¿å±‹ã®ã€Œå†’é™ºã®æº–å‚™ã€ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã§å®Ÿè£…ã™ã‚‹é­”è¡“ãƒ»ç¥ˆç¥·ã‚¹ãƒ­ãƒƒãƒˆç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ã®è©³ç´°ä»•æ§˜ã‚’å®šç¾©ã—ã¾ã™ã€‚

## åŸºæœ¬è¨­è¨ˆæ€æƒ³

### é­”è¡“ãƒ»ç¥ˆç¥·ã®åŒºåˆ¥

- **é­”è¡“ (Spell)**: çŸ¥æµãƒ™ãƒ¼ã‚¹ã®æ”»æ’ƒãƒ»è£œåŠ©é­”æ³•ï¼ˆé­”è¡“å¸«ã€å¸æ•™ãŒä½¿ç”¨ï¼‰
- **ç¥ˆç¥· (Prayer)**: ä¿¡ä»°å¿ƒãƒ™ãƒ¼ã‚¹ã®å›å¾©ãƒ»ç¥è–é­”æ³•ï¼ˆåƒ§ä¾¶ã€å¸æ•™ãŒä½¿ç”¨ï¼‰
- **å…±é€šã‚·ã‚¹ãƒ†ãƒ **: å†…éƒ¨çš„ã«ã¯åŒã˜SpellSystemã‚’ä½¿ç”¨ã€è¡¨ç¤ºãƒ»ç¿’å¾—æ–¹æ³•ã§åŒºåˆ¥

### ã‚¹ãƒ­ãƒƒãƒˆã‚·ã‚¹ãƒ†ãƒ 

- ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ãƒ¬ãƒ™ãƒ«ã«å¿œã˜ãŸã‚¹ãƒ­ãƒƒãƒˆæ•°ï¼ˆæœ€å¤§9ãƒ¬ãƒ™ãƒ«åˆ†ï¼‰
- å„ãƒ¬ãƒ™ãƒ«ã®ã‚¹ãƒ­ãƒƒãƒˆã¯ç‹¬ç«‹ã—ãŸä½¿ç”¨å›æ•°ã‚’æŒã¤
- åœ°ä¸Šå¸°é‚„æ™‚ã«å…¨ã‚¹ãƒ­ãƒƒãƒˆã®ä½¿ç”¨å›æ•°ãŒå›å¾©

## è©³ç´°ä»•æ§˜

### 1. ã‚¹ãƒ­ãƒƒãƒˆæ§‹é€ 

#### ã‚¹ãƒ­ãƒƒãƒˆãƒ¬ãƒ™ãƒ«ã¨æ•°é‡

```yaml
spell_slots_per_level:
  1: 4  # ãƒ¬ãƒ™ãƒ«1ã‚¹ãƒ­ãƒƒãƒˆ: 4å€‹
  2: 3  # ãƒ¬ãƒ™ãƒ«2ã‚¹ãƒ­ãƒƒãƒˆ: 3å€‹
  3: 3  # ãƒ¬ãƒ™ãƒ«3ã‚¹ãƒ­ãƒƒãƒˆ: 3å€‹
  4: 2  # ãƒ¬ãƒ™ãƒ«4ã‚¹ãƒ­ãƒƒãƒˆ: 2å€‹
  5: 2  # ãƒ¬ãƒ™ãƒ«5ã‚¹ãƒ­ãƒƒãƒˆ: 2å€‹
  6: 1  # ãƒ¬ãƒ™ãƒ«6ã‚¹ãƒ­ãƒƒãƒˆ: 1å€‹
  7: 1  # ãƒ¬ãƒ™ãƒ«7ã‚¹ãƒ­ãƒƒãƒˆ: 1å€‹
  8: 1  # ãƒ¬ãƒ™ãƒ«8ã‚¹ãƒ­ãƒƒãƒˆ: 1å€‹
  9: 1  # ãƒ¬ãƒ™ãƒ«9ã‚¹ãƒ­ãƒƒãƒˆ: 1å€‹
```

#### ä½¿ç”¨å›æ•°ã‚·ã‚¹ãƒ†ãƒ 

- å„ã‚¹ãƒ­ãƒƒãƒˆã¯ã€Œã‚¹ãƒ­ãƒƒãƒˆãƒ¬ãƒ™ãƒ«ã€å›ã®ä½¿ç”¨ãŒå¯èƒ½
  - Lv1ã‚¹ãƒ­ãƒƒãƒˆ: 1å›ä½¿ç”¨å¯èƒ½
  - Lv2ã‚¹ãƒ­ãƒƒãƒˆ: 2å›ä½¿ç”¨å¯èƒ½
  - Lv9ã‚¹ãƒ­ãƒƒãƒˆ: 9å›ä½¿ç”¨å¯èƒ½

#### é­”æ³•ã¨ã‚¹ãƒ­ãƒƒãƒˆã®é–¢ä¿‚

- ç¿’å¾—é­”æ³•ãƒ¬ãƒ™ãƒ« â‰¤ ã‚¹ãƒ­ãƒƒãƒˆãƒ¬ãƒ™ãƒ« ã®å ´åˆã®ã¿è£…å‚™å¯èƒ½
- ä¾‹: Lv3é­”æ³•ã¯ Lv3ä»¥ä¸Šã®ã‚¹ãƒ­ãƒƒãƒˆã«ã®ã¿è£…å‚™å¯èƒ½

### 2. ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã‚¯ãƒ©ã‚¹åˆ¥åˆ¶é™

#### é­”è¡“å¸« (Mage)

- **ä½¿ç”¨å¯èƒ½é­”æ³•**: æ”»æ’ƒé­”æ³•ã€æ±ç”¨é­”æ³•
- **ç¦æ­¢é­”æ³•**: å›å¾©ãƒ»è˜‡ç”Ÿç³»ç¥ˆç¥·
- **ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°**: çŸ¥æµå€¤ã§é­”æ³•å¨åŠ›æ±ºå®š

#### åƒ§ä¾¶ (Priest)  

- **ä½¿ç”¨å¯èƒ½é­”æ³•**: å›å¾©ãƒ»ç¥è–é­”æ³•ã€æ±ç”¨é­”æ³•
- **ç¦æ­¢é­”æ³•**: æ”»æ’ƒç³»é­”è¡“
- **ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°**: ä¿¡ä»°å¿ƒå€¤ã§é­”æ³•åŠ¹æœæ±ºå®š

#### å¸æ•™ (Bishop)

- **ä½¿ç”¨å¯èƒ½é­”æ³•**: å…¨ç³»çµ±ã®é­”æ³•ãƒ»ç¥ˆç¥·
- **ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°**: çŸ¥æµãƒ»ä¿¡ä»°å¿ƒã®é«˜ã„æ–¹ã§åŠ¹æœæ±ºå®š

#### ãã®ä»–ã‚¯ãƒ©ã‚¹

- **åŸºæœ¬åˆ¶é™**: é­”æ³•ãƒ»ç¥ˆç¥·ä½¿ç”¨ä¸å¯
- **ä¾‹å¤–**: ç‰¹å®šã®é­”æ³•ã‚¢ã‚¤ãƒ†ãƒ ä½¿ç”¨ã§ä¸€æ™‚çš„ç¿’å¾—å¯èƒ½

### 3. é­”æ³•ç¿’å¾—ã‚·ã‚¹ãƒ†ãƒ 

#### ç¿’å¾—æ–¹æ³•

1. **é­”è¡“æ›¸ãƒ»ç¥ˆç¥·æ›¸è³¼å…¥**: é­”è¡“å¸«ã‚®ãƒ«ãƒ‰ãƒ»æ•™ä¼šã§è³¼å…¥
2. **é­”æ³•ã‚¢ã‚¤ãƒ†ãƒ æ¶ˆè²»**: å®¿å±‹ã®ã‚¢ã‚¤ãƒ†ãƒ æ•´ç†ã§ä½¿ç”¨
3. **ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—å ±é…¬**: ç‰¹å®šãƒ¬ãƒ™ãƒ«åˆ°é”æ™‚ã®è‡ªå‹•ç¿’å¾—

#### ç¿’å¾—æ¡ä»¶

- **ãƒ¬ãƒ™ãƒ«è¦ä»¶**: ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ãƒ¬ãƒ™ãƒ« â‰¥ é­”æ³•ãƒ¬ãƒ™ãƒ«
- **ã‚¯ãƒ©ã‚¹è¦ä»¶**: ä¸Šè¨˜ã‚¯ãƒ©ã‚¹åˆ¥åˆ¶é™ã«å¾“ã†
- **èƒ½åŠ›å€¤è¦ä»¶**: 
  - é­”è¡“: çŸ¥æµ â‰¥ é­”æ³•ãƒ¬ãƒ™ãƒ« Ã— 3
  - ç¥ˆç¥·: ä¿¡ä»°å¿ƒ â‰¥ é­”æ³•ãƒ¬ãƒ™ãƒ« Ã— 3

### 4. UIãƒ‡ã‚¶ã‚¤ãƒ³

#### å®¿å±‹-å†’é™ºã®æº–å‚™-é­”è¡“ã‚¹ãƒ­ãƒƒãƒˆè¨­å®š

##### ãƒ¡ã‚¤ãƒ³ç”»é¢æ§‹æˆ

```
ã€é­”è¡“ã‚¹ãƒ­ãƒƒãƒˆè¨­å®šã€‘

ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼é¸æŠ:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ãƒãƒ«ã‚¹ (é­”è¡“å¸«) Lv.5              â”‚
â”‚ ã‚¹ãƒ­ãƒƒãƒˆä½¿ç”¨çŠ¶æ³: 8/16           â”‚
â”‚ ç¿’å¾—é­”æ³•: 12å€‹                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ã‚¨ãƒªãƒŠ (å¸æ•™) Lv.4                â”‚
â”‚ ã‚¹ãƒ­ãƒƒãƒˆä½¿ç”¨çŠ¶æ³: 6/12           â”‚
â”‚ ç¿’å¾—é­”æ³•: 8å€‹                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

##### å€‹åˆ¥ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ç®¡ç†ç”»é¢

```
ã€ãƒãƒ«ã‚¹ ã®é­”è¡“ç®¡ç†ã€‘

â”Œâ”€ Lv1ã‚¹ãƒ­ãƒƒãƒˆ (4å€‹) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [fireball  ] [ice_shard] [ç©º     ] [ç©º     ] â”‚
â”‚ ä½¿ç”¨å¯èƒ½: 1/1  ä½¿ç”¨å¯èƒ½: 1/1   -      -    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€ Lv2ã‚¹ãƒ­ãƒƒãƒˆ (3å€‹) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [lightning ] [ç©º     ] [ç©º     ]          â”‚
â”‚ ä½¿ç”¨å¯èƒ½: 2/2   -       -              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç¿’å¾—æ¸ˆã¿é­”æ³•ä¸€è¦§:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â–¡ fireball (Lv1) - è£…å‚™ä¸­            â”‚
â”‚ â–¡ ice_shard (Lv1) - è£…å‚™ä¸­           â”‚
â”‚ â–¡ magic_missile (Lv1)               â”‚
â”‚ â–¡ lightning (Lv2) - è£…å‚™ä¸­           â”‚
â”‚ â–¡ fireball_greater (Lv3)            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

[ã‚¹ãƒ­ãƒƒãƒˆã«è£…å‚™] [è£…å‚™è§£é™¤] [æˆ»ã‚‹]
```

#### æ“ä½œãƒ•ãƒ­ãƒ¼

1. **ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼é¸æŠ**: é­”æ³•ä½¿ç”¨å¯èƒ½ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã‹ã‚‰é¸æŠ
2. **ã‚¹ãƒ­ãƒƒãƒˆè¡¨ç¤º**: ãƒ¬ãƒ™ãƒ«åˆ¥ã‚¹ãƒ­ãƒƒãƒˆçŠ¶æ³ã‚’è¦–è¦šçš„ã«è¡¨ç¤º
3. **é­”æ³•è£…å‚™**: ç¿’å¾—æ¸ˆã¿é­”æ³•ã‹ã‚‰ã‚¹ãƒ­ãƒƒãƒˆã«è£…å‚™
4. **è£…å‚™è§£é™¤**: è£…å‚™ä¸­é­”æ³•ã‚’ã‚¹ãƒ­ãƒƒãƒˆã‹ã‚‰è§£é™¤
5. **ç¢ºèªãƒ»ä¿å­˜**: å¤‰æ›´å†…å®¹ã‚’ç¢ºèªã—ã¦ä¿å­˜

### 5. ç¥ˆç¥·ã‚¹ãƒ­ãƒƒãƒˆè¨­å®š

ç¥ˆç¥·ã‚¹ãƒ­ãƒƒãƒˆè¨­å®šã¯é­”è¡“ã‚¹ãƒ­ãƒƒãƒˆè¨­å®šã¨ã»ã¼åŒæ§˜ã®ä»•æ§˜ã§ã™ãŒã€ä»¥ä¸‹ã®ç‚¹ã§ç•°ãªã‚Šã¾ã™:

#### ç›¸é•ç‚¹

- **å¯¾è±¡ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼**: åƒ§ä¾¶ãƒ»å¸æ•™ã®ã¿
- **é­”æ³•ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°**: ç¥ˆç¥·ç³»é­”æ³•ã®ã¿è¡¨ç¤º
- **ã‚¢ã‚¤ã‚³ãƒ³è¡¨ç¤º**: ğŸ”®â†’ğŸ“¿ã«å¤‰æ›´
- **UIè¡¨è¨˜**: ã€Œé­”è¡“ã€â†’ã€Œç¥ˆç¥·ã€

### 6. æŠ€è¡“å®Ÿè£…è¦ä»¶

#### ãƒ‡ãƒ¼ã‚¿æ§‹é€ 

```python
@dataclass
class CharacterSpellSlots:
    character_id: str
    spell_slots: Dict[int, List[SpellSlot]]  # ãƒ¬ãƒ™ãƒ«åˆ¥ã‚¹ãƒ­ãƒƒãƒˆ
    learned_spells: List[str]                # ç¿’å¾—æ¸ˆã¿é­”æ³•ID
```

#### ä¸»è¦ãƒ¡ã‚½ãƒƒãƒ‰

```python
def equip_spell_to_slot(character_id: str, spell_id: str, level: int, slot_index: int) -> bool
def unequip_spell_from_slot(character_id: str, level: int, slot_index: int) -> Optional[str]
def can_equip_spell(character: Character, spell: Spell, level: int) -> bool
def get_available_spells_for_character(character: Character) -> List[Spell]
def restore_all_spell_uses(character_id: str) -> None
```

#### UIè¦ç´ 

- `DirectScrolledList`: ç¿’å¾—é­”æ³•ä¸€è¦§è¡¨ç¤º
- `DirectButton`: ã‚¹ãƒ­ãƒƒãƒˆè¡¨ç¤ºãƒ»è£…å‚™ãƒœã‚¿ãƒ³
- `DirectFrame`: ã‚¹ãƒ­ãƒƒãƒˆãƒ¬ãƒ™ãƒ«åˆ¥ã‚°ãƒ«ãƒ¼ãƒ”ãƒ³ã‚°
- `DirectLabel`: ä½¿ç”¨å›æ•°ãƒ»ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤º

### 7. ã‚»ãƒ¼ãƒ–ãƒ»ãƒ­ãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿

#### ã‚»ãƒ¼ãƒ–ãƒ‡ãƒ¼ã‚¿æ§‹é€ 

```json
{
  "character_spell_data": {
    "character_id_1": {
      "learned_spells": ["fireball", "ice_shard", "lightning"],
      "spell_slots": {
        "1": [
          {"spell_id": "fireball", "current_uses": 1, "max_uses": 1},
          {"spell_id": "ice_shard", "current_uses": 0, "max_uses": 1},
          {"spell_id": null, "current_uses": 0, "max_uses": 1},
          {"spell_id": null, "current_uses": 0, "max_uses": 1}
        ],
        "2": [
          {"spell_id": "lightning", "current_uses": 2, "max_uses": 2},
          {"spell_id": null, "current_uses": 0, "max_uses": 2},
          {"spell_id": null, "current_uses": 0, "max_uses": 2}
        ]
      }
    }
  }
}
```

### 8. ãƒ†ã‚¹ãƒˆè¦ä»¶

#### å˜ä½“ãƒ†ã‚¹ãƒˆ

- [ ] ã‚¹ãƒ­ãƒƒãƒˆè£…å‚™ãƒ»è§£é™¤æ©Ÿèƒ½
- [ ] é­”æ³•ä½¿ç”¨ãƒ»å›å¾©æ©Ÿèƒ½  
- [ ] ã‚¯ãƒ©ã‚¹ãƒ»ãƒ¬ãƒ™ãƒ«åˆ¶é™ãƒã‚§ãƒƒã‚¯
- [ ] ã‚»ãƒ¼ãƒ–ãƒ»ãƒ­ãƒ¼ãƒ‰æ©Ÿèƒ½

#### çµ±åˆãƒ†ã‚¹ãƒˆ

- [ ] UIæ“ä½œãƒ•ãƒ­ãƒ¼å…¨ä½“
- [ ] è¤‡æ•°ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ç®¡ç†
- [ ] ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

#### ã‚·ãƒŠãƒªã‚ªãƒ†ã‚¹ãƒˆ

- [ ] æ–°è¦ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã§ã®åˆæœŸè¨­å®š
- [ ] ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—æ™‚ã®ã‚¹ãƒ­ãƒƒãƒˆå¢—åŠ 
- [ ] æˆ¦é—˜â†’åœ°ä¸Šå¸°é‚„ã§ã®å›å¾©

## å®Ÿè£…å„ªå…ˆåº¦

### Phase 1: åŸºç›¤å®Ÿè£…

1. SpellSlotç®¡ç†ã‚·ã‚¹ãƒ†ãƒ æ‹¡å¼µ
2. ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼åˆ¥ã‚¹ãƒ­ãƒƒãƒˆåˆæœŸåŒ–
3. åŸºæœ¬çš„ãªè£…å‚™ãƒ»è§£é™¤æ©Ÿèƒ½

### Phase 2: UIå®Ÿè£…

1. å®¿å±‹ãƒ¡ãƒ‹ãƒ¥ãƒ¼çµ±åˆ
2. ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼é¸æŠUI
3. ã‚¹ãƒ­ãƒƒãƒˆç®¡ç†UI

### Phase 3: è©³ç´°æ©Ÿèƒ½

1. é­”æ³•ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
2. ä½¿ç”¨å›æ•°ç®¡ç†
3. ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

### Phase 4: æœ€é©åŒ–ãƒ»ãƒ†ã‚¹ãƒˆ

1. UIæ”¹å–„ãƒ»æœ€é©åŒ–
2. åŒ…æ‹¬çš„ãƒ†ã‚¹ãƒˆå®Ÿè£…
3. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹èª¿æ•´

## é–¢é€£ãƒ•ã‚¡ã‚¤ãƒ«

- `src/magic/spells.py`: åŸºç›¤é­”æ³•ã‚·ã‚¹ãƒ†ãƒ 
- `src/overworld/facilities/inn.py`: å®¿å±‹ãƒ¡ãƒ‹ãƒ¥ãƒ¼çµ±åˆ
- `src/character/character.py`: ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã‚¹ãƒ­ãƒƒãƒˆç®¡ç†
- `config/spells.yaml`: é­”æ³•å®šç¾©
- `tests/test_spell_slots.py`: ã‚¹ãƒ­ãƒƒãƒˆã‚·ã‚¹ãƒ†ãƒ ãƒ†ã‚¹ãƒˆ

---
priority: 1
tags: ["feature", "dungeon", "critical", "gameplay", "navigation"]
description: "ダンジョン階段システムと地上への出口実装"
created_at: "2025-07-22T13:27:12Z"
started_at: null  # Do not modify manually
closed_at: null   # Do not modify manually
---

# Ticket Overview

ダンジョンに入った後、同じ階層内でしか移動できず、地上へ戻ることも下の階層へ進むこともできない重大な機能欠落。
階段システムが実装されていないため、プレイヤーはダンジョンに閉じ込められた状態になり、ゲーム進行が不可能になっている。

## 現状の問題
- ダンジョンから地上へ戻る手段がない（出口がない）
- 下の階層への階段がない
- 上の階層への階段もない
- プレイヤーは一度ダンジョンに入ると脱出不可能
- ダンジョン探索の基本的なゲームループが成立していない

## 必要な機能
- 地上への出口（1階の特定位置）
- 下り階段（次の階層への移動）
- 上り階段（前の階層への移動）
- 階段での移動確認ダイアログ
- 階層移動時の演出・エフェクト

## Tasks

- [ ] 階段オブジェクトの定義（上り階段、下り階段、出口）
- [ ] ダンジョンマップへの階段配置ロジック実装
- [ ] 階段の3D表示実装（視覚的に認識可能にする）
- [ ] プレイヤーが階段に到達した際の判定処理
- [ ] 階段使用時の確認ダイアログ実装
- [ ] 階層移動処理の実装（上下階層への遷移）
- [ ] 地上への出口処理の実装（OverworldManagerへの遷移）
- [ ] 階層移動時のセーブポイント処理
- [ ] 階層移動エフェクト・演出の実装
- [ ] 階段位置のミニマップ表示対応
- [ ] 階段に関するイベント通知実装
- [ ] テストダンジョンでの動作確認（1階→地上、1階→2階、2階→1階）
- [ ] Run tests before closing and pass all tests (No exceptions)
- [ ] Get developer approval before closing

## Notes

- 優先度1（Critical）：ダンジョンから脱出できないことは、ゲームの基本的な進行を妨げる致命的な問題
- Wizardry風ダンジョンクローラーでは、階段システムは必須の基本機能
- 1階には必ず地上への出口を配置する必要がある
- 各階層には少なくとも1つの上り階段と下り階段を配置（最下層を除く）
- 階段の位置は固定またはシード値による一貫した配置にする必要がある

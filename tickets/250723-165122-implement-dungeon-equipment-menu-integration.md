---
priority: 2
tags: ["ui", "dungeon", "equipment", "menu", "feature", "integration"]
description: "ダンジョンメニューの[装備]ボタン機能を実装し、既存の装備システムと連携"
created_at: "2025-07-23T16:51:22Z"
started_at: null  # Do not modify manually
closed_at: null   # Do not modify manually
---

# Ticket Overview

ダンジョンメニューの[装備]ボタンを押しても現在何も起こらない状態になっている。調査の結果、装備システム自体は完全に実装済みで武器・防具・アクセサリの管理機能を持っているが、ダンジョンメニューからの呼び出し処理が未実装であることが判明。既存の装備管理システムとダンジョンメニューを適切に連携させる必要がある。

## 問題の詳細

### 現状
- **✅ 装備システム**: 完全な装備管理システムが実装済み
- **✅ 装備ウィンドウ**: WindowSystemベースの装備ウィンドウが実装済み
- **✅ 装備マネージャー**: 装備統一管理システムが実装済み
- **✅ ダンジョンメニューUI**: [装備]ボタンは表示されている
- **❌ アクション処理**: ボタンを押しても「未実装」ログが出力されるのみ
- **❌ システム間連携**: ダンジョンメニューと装備システムが未接続

### 技術的問題
1. **ダンジョンメニューの`execute_menu_action`で装備処理が未実装**
2. **装備システム連携のコールバック設定が欠如**
3. **ダンジョンコンテキストでの装備メニュー表示処理が未実装**

### 影響
- プレイヤーがダンジョン内で装備確認・変更ができない
- 戦闘前の装備調整ができない
- キャラクターの装備状況が把握できない
- 拾得したアイテムの装備ができない

## 装備システムの特徴

### 装備カテゴリ
- **武器**: 剣、斧、杖、弓等の攻撃用装備
- **防具**: 鎧、盾、兜等の防御用装備
- **アクセサリ**: 指輪、首飾り等の特殊効果装備

### 装備スロット
- **主要スロット**: 武器、防具、盾、兜
- **補助スロット**: アクセサリ、指輪類
- **両手武器**: 特定武器での盾スロット制限

### 装備効果
- **基本能力値**: 攻撃力、防御力、魔法防御力
- **特殊効果**: 魔法耐性、状態異常耐性、能力値ボーナス
- **職業制限**: 職業別装備可能制限

## Tasks

- [ ] ダンジョンメニューの装備アクション処理を実装
- [ ] `DungeonUIManagerPygame`に装備メニュー呼び出し機能を追加
- [ ] 装備システムとの連携設定を実装
- [ ] ダンジョンメニューマネージャーでの装備コールバック設定
- [ ] ダンジョン内での装備ウィンドウ表示動作確認
- [ ] 装備変更・装着・取り外し機能の動作確認
- [ ] 複数キャラクターの装備表示テスト
- [ ] 装備効果反映・計算機能の動作確認
- [ ] 装備ウィンドウからの正常な復帰動作確認
- [ ] Run tests before closing and pass all tests (No exceptions)
- [ ] Get developer approval before closing

## 受け入れ条件

- [ ] ダンジョンメニューで[装備]ボタンを押すと装備ウィンドウが表示される
- [ ] 装備ウィンドウでパーティメンバーの切り替えができる
- [ ] キャラクターの現在装備状況が正しく表示される
- [ ] 装備の変更・装着・取り外しが正常に動作する
- [ ] 装備効果が正しく計算・反映される
- [ ] 装備ウィンドウを閉じるとダンジョン画面に戻る
- [ ] ESCキーで装備ウィンドウが閉じられる
- [ ] ダンジョン内でのUI階層管理が正常に動作する
- [ ] 全てのテストが通過している

## 実装対象ファイル

### 主要修正対象
1. **`src/ui/dungeon/dungeon_ui_manager_pygame.py`**
   - 装備メニュー呼び出し機能の実装
   - 装備システムとの連携

2. **`src/ui/windows/dungeon_menu_window.py`**  
   - `execute_menu_action()`での`equipment`アクション処理実装

3. **`src/ui/windows/dungeon_menu_manager.py`**
   - 装備コールバックの設定

### 既存活用可能なシステム
- **装備管理システム** - 完全な装備システム実装済み
- **装備ウィンドウシステム** - WindowSystemベース装備ウィンドウ実装済み
- **装備マネージャー** - 装備統一管理システム実装済み

## 実装アプローチ

### 1. DungeonUIManagerPygameの拡張
```python
def _open_equipment_menu(self):
    """ダンジョン内で装備メニューを開く"""
    if self.equipment_manager:
        self.equipment_manager.show_equipment_menu()
    else:
        logger.warning("装備マネージャーが初期化されていません")
```

### 2. ダンジョンメニューとの連携
```python
# dungeon_menu_window.py内
elif action == "equipment":
    self.close_menu()
    if "equipment" in self.callbacks:
        self.callbacks["equipment"]()
```

### 3. コールバック設定
```python
# dungeon_menu_manager.py内
def set_equipment_callback(self, callback):
    """装備コールバックを設定"""
    self.dungeon_menu_window.set_callback("equipment", callback)
```

## Notes

### 設計思想
- **既存システム活用**: 完成した装備システムを最大限活用
- **戦術的価値**: ダンジョン探索での装備戦略の実現
- **UI統一性**: ダンジョン内外での一貫した装備メニュー操作

### 装備システムの価値
- **戦略的装備変更**: 状況に応じた装備調整
- **キャラクター成長**: 新装備による能力向上実感
- **リソース管理**: 限られた装備枠での最適化
- **探索効率**: 発見装備の即座活用

### 関連システム
- **EquipmentManager**: 装備システム統合管理
- **EquipmentWindow**: 装備メニュー統一インターフェース
- **WindowSystem**: UI階層管理システム
- **キャラクターシステム**: 装備効果計算・反映

### テスト観点
- 装備効果計算の正確性
- 装備制限（職業・レベル）の適用
- UI遷移の安定性
- エラー時の適切な処理

### 優先度の理由
装備はダンジョン探索・戦闘における基本的な戦略要素であり、キャラクター強化の中核機能。既存の装備システムが活用できない状態は大きな機能損失。装備システム自体は完成しているため、比較的短期間で実装可能。
